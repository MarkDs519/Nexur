"use strict";

var toPosInt     = require("es5-ext/number/to-pos-integer")
  , callable     = require("es5-ext/object/valid-callable")
  , defineLength = require("es5-ext/function/_define-length")
  , slice        = Array.prototype.slice
  , apply        = Function.prototype.apply
  , curry;

curry = function self(fn, length, preArgs) {
	return defineLength(
		function () {
			var args = preArgs
				? preArgs.concat(slice.call(arguments, 0, length - preArgs.length))
				: slice.call(arguments, 0, length);
			return args.length === length ? apply.call(fn, this, args) : self(fn, length, args);
		},
		preArgs ? length - preArgs.length : length
	);
};

module.exports = function (/* Length*/) {
	var length = arguments[0];
	return curry(callable(this), isNaN(length) ? toPosInt(this.length) : toPosInt(length));
};
